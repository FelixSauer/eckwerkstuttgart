---
import type {ImageMetadata} from "astro";
import {getCollection} from "astro:content";
import Layout from "../layouts/multi.astro";
import "@fontsource-variable/montserrat";
import "@fontsource-variable/fira-code";
import "@fontsource-variable/source-code-pro";
import '@fontsource/source-sans-pro';
import "@fontsource/roboto";
import "./../styles/GlobalStyling.scss";
import Reviews from "../components/Reviews.astro";

const pages = await getCollection("pages");

const ParallaxImagesSrc = import.meta.glob<{ default: ImageMetadata }>("../assets/Albums/Parallax/*");
const ParallaxImages = Object.keys(ParallaxImagesSrc);

const IntroImagesSrc = import.meta.glob<{ default: ImageMetadata }>("../assets/Albums/Intro/*");
const IntroImages = Object.keys(IntroImagesSrc);
const IntroImage = await IntroImagesSrc[IntroImages[0]]();
---

<Layout title="Eckwerk Stuttgart">
    <section class="introimage" style={`background-image: url('${IntroImage.default.src}')`}>
        <article>{pages[0].data.slogan && <h1>{pages[0].data.slogan}</h1>}</article>
    </section>

	{pages.map(async (originPage, index) => {
		const {Content} = await originPage.render();
		const imagePath = ParallaxImages[index % ParallaxImages.length];
		const image = await ParallaxImagesSrc[imagePath]();

		return originPage.data.mainStage === true ? (
            <>
                <section class="content" id={originPage.data.title}
                         style={originPage.data.title !== "Kontakt" ? `background-image: url('${image.default.src}'); @media (max-width: 768px) { background-image: url('/path/to/mobile-image.jpg'); }` : null}>
                    <article>
                        <Content/>
                    </article>
                </section>


							{index === 3 &&
                      <section class="subcontent">
                          <article>
                              <Reviews/>
                          </article>
                      </section>
                      <section class="subcontent">
                          <article>
                              Gallery
                          </article>
                      </section>}
            </>
		) : null;
	})}
</Layout>

<style lang="scss" is:global>
  @import "./../styles/GlobalStyling";

  section {
    height: 100vh;
    background-attachment: fixed;
    background-position: 25%;
    background-repeat: no-repeat;
    background-size: cover;
    scroll-margin-top: 30vh;
    background-color: $color-white;

    article {
      padding: 2.5vw 15vw;
      background-color: $color-white;
    }

    &.subcontent {
      height: auto;
      background-color: $color-white;

      article {
        padding: 2.5vw 5vw;
        background-color: $color-white;

        @include min-width('s') {
          padding: 2.5vw 10vw;
        }

        @include min-width('m') {
          padding: 2.5vw 10vw;
        }

        @include min-width('l') {
          padding: 2.5vw 20vw;
        }

        @include min-width('xl') {
          padding: 2.5vw 20vw;
        }
      }
    }

    &.introimage {
      display: flex;
      justify-content: center;
      align-items: center;
      background-position: 45%;

      article {
        padding: 0 15vw 25vh;
        background-color: unset;

        h1 {
          font-size: 7rem !important;
          font-weight: 400;
          color: $color-white;
          text-align: center;
        }
      }
    }
  }
</style>

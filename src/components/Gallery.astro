---
import type {ImageMetadata} from 'astro';
import {Image} from 'astro:assets';
import {getImage} from "astro:assets";

interface Props {
	imageCollection: string;
}

const {imageCollection} = Astro.props;
const images = import.meta.glob<{ default: ImageMetadata }>("/src/assets/Albums/*/*");

console.log(images) // REMOVE ME LATER

const imagePaths = Object.keys(images).filter((imagePath) => {

	return imagePath.startsWith(`/src/assets/Albums/${imageCollection}/`);
});
---

<div id="gallery">
	{
		imagePaths.map(async (imagePath) => {
			let image = images[imagePath]();
			let optimizedImage = await getImage({
				src: image,
				width: 1920,
			});

			return (
              <a
                      href={optimizedImage.src}
                      data-pswp-width={optimizedImage.attributes.width}
                      data-pswp-height={optimizedImage.attributes.height}
                      target="_blank"
                      class="overflow-hidden rounded-md border-[1px] border-primary hover:border-secondary"
              >
                  <Image
                          src={image}
                          alt={"altText"}
                          height={350}
                          
                  />
              </a>
			);
		})
	}
</div>

<script>
	import PhotoSwipeLightbox from "photoswipe/lightbox";
	import "photoswipe/style.css";

	const lightbox = new PhotoSwipeLightbox({
		gallery: "#gallery",
		children: "a",
		pswpModule: () => import("photoswipe"),
	});

	lightbox.init();
</script>
